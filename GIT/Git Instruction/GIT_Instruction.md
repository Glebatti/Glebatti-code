# Руководство по git.

## Базовые команды для работы в gitbash:
1. Создание папки в текущей директории:
	```
	mkdir <Ваша папка>
	```
2. Переход в указанную директорию:
	```
	cd <Указанная директория> или  cd <Указанная директория>/<Указанная директория>/...
	```
3. Создание файла в текущей дериктории:
	```
	touch <Название файла>
	```
4. Войти в файл:
	```
	vim <название файла>
	```
5. Переименовать файл:
	```
	git mv
	```
6. Удалить файл 
	```
	git rm
	```
7. Для удобства запуска утилиты gitbash перейти в корень программы (меню "пуск" > ввести "git bash" > нажать ***"перейти к расположению файла"***), нажать правой кнопкой мыши по ярлыку c названием "Git Bash", выбрать ***"Свойства"***, нажать левой кнопкой мыши в окне ***"Быстрый вызов"***, нажать на клавиатуре нужную комбинацию клавиш(хоткей) (по умолчанию: "Ctrl + Alt + T") и левой кнопкой мыши по полю ***"Применить"*** (при всплывании окна прав администратора - подтверждаем)

## Подготовка к работе с гит:
1. Установка имени и электронной почты.
Для начала необходимо осуществить установку, если не выполнялась ранее.
Все установки прописываются в файл .gitconfig, находящегося по пути ~/.gitconfig. Выполнить следующие команды, чтобы git узнал имя и электронную почту.
	```
	git config --global user.name "your_name"
	```
	```
	git config --global user.email "your_email@whatever.com"
	```
2. Установка отображения unicode.
По умолчанию, git будет печатать не-ASCII символы в именах файлов в виде восьмеричных последовательностей \nnn. Чтобы избежать нечитаемых строк, установить соответствующий флаг:
	```
	git config --global core.quotepath off
	```
3. Посмотреть файл конфигурации, в котором отражена информация о пользователе git и алиасы командой: 
	```
	cat .gitconfig
	```

## Основные команды для работы с Git.
Отслеживание и фиксация изменений.
1. Создать репозиторий с помощью команды:
	```
	git init
	```
2. Проверить статус репозитория:
(status — важнейшая команда, которая показывает информацию о текущем состоянии репозитория: актуальна ли информация на нём, нет ли чего-то нового, что поменялось)
	```
	git status
	```
3. Подготовить файлы для снимка текущего состояния (предварительно перейдя в нужную дерикторию с помощью команды cd).
Пример:
	```
	git add <generate_report.py>
	```
	```
	git add <report_helper.py>
	```
	```
	git add <for_read_xml.py>
	```
4. Если нам нужно добавить все, что находится в директории, мы можем использовать:
	```
	git add -A
	```
1. Убедиться, что файлы отслеживаются Git с помощью команды 
   ```
   git status
   ```
2. Закоммитить(комментарий) файлы, повторив команду для каждого файла.
	```
	git commit -m '<Описание изменения>'
	```
6. Если вдруг нам нужно переделать commit message и внести туда новый коммит, написать следующую конструкцию:
	```
	git commit --amend -m '<Новый комментарий>'
	```
7. Просмотреть историю коммитов можно с помощью команды(отображаются также "Оригинальные" и "отмененные" ком миты отображаются в истории ветки:
	```
	git log & (-p) - последний коммит.
	```
8. Просмотреть содержимое файла в текущей директории можно с помощью команды:
	```
	git cat <имя файла>
	```

## Алиасы
Простыми словами - макросы, с сокращенными именами для удобства ввода необходимых команд.
1. Перейти в *корневой каталог локального пользователя(домашний)* командой:
	```
	cd ~
	```
2. Прописать в файл конфигурации алиасы командами:
	```
	git config --global alias.co checkout
	```
	```
	git config --global alias.ci commit
	```
	```
	git config --global alias.st status
	```
	```
	git config --global alias.br branch
	```
	```
	git config --global alias.hist "log --pretty=format:'%h %ad | %s%d [%an]' --graph --date=short"
	```
	```
	git config --global alias.type 'cat-file -t'
	```
	```
	git config --global alias.dump 'cat-file -p'
	```
***Примечание: теперь для команды***
```git checkout``` ***достаточно использовать сокращенную форму*** ```git co``` .

и.т.д.

## Добавление и удаление тегов
1. Отметить коммит, чтобы потом его можно было легко найти:
	```
	git tag <тег>
	```
***Примечание:
Данная команда добавляет тэг к последнему созданному коммиту***

2. Удалить тэг можно с помощью команды:
	```
	git tag -d <тег>
	```

## Работа с ветками
Ветка в git - простой перемещаемый указатель на один из таких коммитов. По умолчанию, имя основной ветки в git - **master** . Как только создается коммит, ветка **master**  будет всегда указывать на последний коммит. Каждый раз при создании коммита указатель ветки **master** будет передвигаться на следующий коммит автоматически.
***Важно: перед переключением на другую ветку, иметь ввиду - если рабочий каталог либо индекс содержат незафиксированные изменения, конфликтующие с веткой, на которую нужно переключиться, то git не позволит переключить ветки. Лучше всего переключатся из чистого рабочего состояния проекта.***
Git определяет в какой текущие локальной ветке находится пользователь с помощью специального указателя **HEAD**.
1. Для того, чтобы создать ветку и сразу же переключиться на нее, выполнить команду:
	```
	git checkout -b <имя ветки>
	```
***Примечание:
**HEAD** перемещается, когда делается checkout.
Это то же самое что и:***
	```
	git branch <имя ветки>
	git checkout <имя ветки>
	```

2. Возвратить рабочий каталог к любому предыдущему состоянию можно с помощью команды:
	```
	git restore <хэш или тэг> - перейти в версию файла последнего коммита.
	
	git diff --staged - показ изменений в файле
	```
3. Вывод хэшей командой:
	```
	git hist --all
	```
3. Для перехода к нужному коммиту с сохранением текущей ветки использовать команду:
	```
	git checkout -m <хэш или тэг>
	```


## Отмена проиндексированных изменений
1. После изменения файла проиндексировать изменение с помощью:
	```
	git add <имя файла>
	```
2. Проверить состояние с помощью команды:
	```
	git status
	```
3. Если состояние показывает, что изменение было проиндексировано и готово к коммиту, то выполнить сброс буферной зоны с помощью команды:
	```
	git reset HEAD <имя файла>
	```

## Отмена коммитов
1. После изменения файла и коммита,чтобы отменить коммит, необходимо сделать коммит,который удаляет измения, сохраненные нежелательным коммитом.
	```
	git revert HEAD
	```
***Примечание : Так как отменися самый последний произведенный коммит, то можно использовать HEAD в качестве аргумента для отмены. Можно отменить любой произвольной коммит в истории, указав его хэш-значение.***

2. Увидеть изменения можно с помощью команды:
	```
	git hist
	```

## Удаление коммита из ветки
1. Просмотреть все коммиты с помощью команды:
	```
	git hist
	```
2. Сбросить коммит к предшествующему тегу <тег> с помощью команды:
	```
	git reset <тег>(до которого необходимо сбросить ветку)
	```
3. Игнорировать контроль версий файлов:
	```
	gitignore .(внутри прописать,названия проигнорируемых файлов)
	```
***Примечание: 
Можно увидеть, что все коммиты еще находятся в репозитории, выполнив команду:***
```git hist --all```


 ## Изменение коммитов
1. Изменить коммит можно с помощью команд:
	```
	git add <имя файла(который закоммитили ранее)>
	
	git commit --amend -m <измененное описание>
	```

## Перемещение файлов в другой каталог
1. Если требуется создать каталог, предварительно перейти в нужную директорию, то использовать следущие команды:
	```
	cd <нужная директория>
	```
	```
	mkdir <каталог>
	```
2. Перенести файл с помощью команды:
	```
	git mv <имя файла> <каталог>
	```
***Примечание:
Перемещая файлы с помощью git, мы информируем git о 2 вещах:***
* Что файл <имя файла> был удален.
* Что файл <каталог>/<имя файла> был создан.
Оба эти факта проиндексированы и готовы к коммиту. 
Команда git status сообщает, что файл был перемещен.

## Работа с каталогом Git.
1. Существует каталог, в котором хранятся все «материалы» git. Данная команда выведет каталог:

	```
	ls -C .git
	```
2.  Множество каталогов, имена которых состоят из 2 символов. Имена каталогов являются первыми двумя буквами хэша sha1 объекта, хранящегося в git. Просмотр базы данных объектов с помощью команды:

	```
	ls -C .git/objects
	```
3. Смотрим в один из каталогов с именем из 2 букв. Там содержатся файлы с именами из 38 символов. Это файлы, содержащие объекты, хранящиеся в git. Они сжаты и закодированы, поэтому просмотр их содержимого не имеет особого значения. Вывести их можно с помощью команды:
   
	```
	ls -C .git/objects/<директория>
	```
4. Просмотреть файл конфигурации, создающийся для каждого конкретного проекта (записи в этом файле будут перезаписывать записи в файле .gitconfig главного каталога) с помощью команды:
   
	```
	cat .git/config
	```
5. Найти последний коммит можно с помощью команды:
   
	```
	git hist --max-count=1
	```
6. Вывести нужный коммит, показывающий подробную информацию с помощью команд:
   
	```
	git cat-file -p <хэш>
	```
7. Вывеcти нужное дерево каталогов, ссылка на который идет в коммите с помощью команды:
	```
	git cat-file -p <хэш дерева>
	```
8. Вывод файла по хэшу с помощью команды:
	```
	git cat-file -p <хэш файла>
	```

## Создание локальных веток в репозитории и переключение между ними:
1. Создать ветку с помощью команды:
	```
	git checkout -b style либо git branch <имя ветки>
	```
2. Переключение между веток осуществляется с помощью команды:
	```
	git checkout <имя ветки>
	```
3. Просмотреть все ветки:
	```
	git branch -a
	```
4. Удалить ветку:
	```
	git branch -d(-D если есть коммиты)
	```
5. Соединить ветки:
	```
	git merge <имя ветки с которой хотим соединить ветку,в которой мы сейчас находимся>
	```

## Cвязаться с GitHub
1. Ссылка на репозиторий в GitHub:
	```
	git remote add origin <url https/ssh>
	```
2. Отправить файлы на сервер:
	```
	git push origin master
	```
3. Загрузить ветку с коммитами с GitHub:
	```
	git pull origin master
	```
4. Скачать недостающие коммиты:
	```
	git fetch origin
	```
5. Соединить локальную ветку с удаленной:
	```
	git push --set -upstream origin master
	```
6. Подгрузить коммиты с GitHub:
	```
	git rebase master
	```
7. Отправить все теги на сервер:
	```
	git push --tags
	```

## Создание чистого репозитория
1. Подключиться к удаленному серверу с помощью команды:
	```
	ssh://<имя пользователя>@<ip сервера>:<порт>
	```
2. Перейти по необходимому пути и создать каталог с помощью команды:
	```
	cd <абсолютный/путь>
	```
	```
	mkdir<каталог>
	```
3. Перейти в каталог и выполнить команду:
	```
	git init --bare
	```

## Загитить нужные файлы удаленно
1. Создать алиас для быстрого доступа к удаленному репозиторию(создавать и проверять алиасы следует предварительно перейдя в рабочий каталог).
	```
	git remote add <название> ssh://<имя пользователя>@<ip сервера>:<порт>/<асболютный/путь>
	```
2. Проверить алиас командой:
	```
	git remote show <алиас>
	```
3. Клонирование репозитория с удаленного сервера на локальный компьютер c помощью команды:
	```
	git clone <алиас>
	```
4. В случае, если необходимо загрузить необходимую ветку с коммитами после клонирования с удаленного репозитория - следует использовать команду:
	```
	git pull <алиас> <ветка>
	```
***Примечание: Сначала команда*** ```git pull``` ***запускает команду*** ```git fetch``` ***для загрузки содержимого из указанного удаленного репозитория.***

***Затем выполняется команда*** ```git merge```, ***объединяющая ссылки и указатели удаленного содержимого в новый локальный коммит слияния.*** 

5. Загитить файлы из локального репозитория на удаленный сервер с помощью команды:
	```
	git push <алиас>
	```

## Git в PyCharm
1. Подключить git к PyCharm:
	```
	git remote->get from vresion control
	```
2. Поставить коммит:
	```
	Ctrl+K
	```
3. Посмотреть, кто изменял коммит:
	```
	Annotate
	```
4. Отменить изменения до последнего коммита:
	```
	Rollback
	```
5. Перенести коммиты с другой ветки на ветку master:
	```
	Checkout and rebase onto 'Master'
	```
6. Забрать все коммиты из другой ветки для текущей ветки:
	```
	Merge into curent
	```

## Подключение к удаленному серверу с помощью протокола ssh.
SSH - это протокол, использующий клиент-серверную модель для процедуры проверки подлинности удаленных систем и обеспечения шифрования данных, обмен которыми происходит в рамках удаленного доступа.

По умолчанию для работы протокола используется TCP-22 порт: на нем сервер (хост) ожидает входящее подключение и, после получения команды и проведения аутентификации, организует запуск клиента, открывая выбранную пользователем оболочку.

Для создания SSH подключения клиент должен инициировать соединение с сервером, обеспечив защищенное соединение и подтвердив свой идентификатор (проверяются соответствие идентификатора с предыдущими записями, хранящимися в RSA-файле, и личные данные пользователя, необходимые для аутентификации)

* Все команды выполняются от указанного перед командой пользователя, например:
	```
	user@machine:~$ --- 
	```
означает что команды вводятся в терминале пользователя user имеющего обычные права ($). 

Если указан символ (#) – пользователь обладает правами супер-пользователя (root). При выполнении команд контролировать результат выполнения. При возникновении ошибки – следует изучить результат и подробный вывод команд (возможно применение ключа -v). 

* Для изучения процесса работы SSH-службы и просмотра журнала следует открыть окно оснастки (нажать сочетание клавиш Win+R) ввести команду и нажать Enter:
	```
	eventvwr.msc /s
	```
В окне оснастки пройти по пути: **"Просмотр событий (Локальный)"** –> **"Журналы приложений и служб"** –> **"Open SSH"** -> **"Operational"**. 

В средней части окна оснастки будут выведены все события генерируемые службой SSH.

## Установка и настройка службы SSH

1. Необходимо проверить и удалить директорию .shh в локальной директории пользователя. 
   
***Примечание: директория .ssh должна удаляться со всем содержимым. Также проверить наличие файлов ключей и прочих настроек ssh в локальной директории пользователя командой:***
	```
	user@machine:~$ rm -r .ssh
	```

2. На компьютере пользователя (платформа Windows 10) запустить службу ssh-agent с помощью команд:
	```
	Win+R -> ввести в поле **ssh-agent** -> нажать enter
	```
Служба **ssh-agent** (далее - Агент) предназначена для управления ssh-ключами, паролями и сертификатами пользователя. 

Избавляет от необходимости каждый раз указывать файл ключа при подключении к серверу по протоколу ssh. Агент не записывает ключи и другую информацию о них на диск, не позволяет экспортировать приватные ключи. 

Приватные ключи хранящиеся в Агенте используются только подписания сообщений.Служба работает в фоном режиме в системе пользователя отдельно от службы ssh

## Для установки ssh-agent(далее - Агент) выполнить действия и команды:
1. Запустить bash-терминал. Создать файл пользовательского профиля для автоматизации действий перед запуском терминала командой:
	```
	user@machine:~$ touch ~/.profile
	```
2. Открыть файл для редактирования с помощью любого редактора. Пример:
	```
	user@machine:~$ notepad ~./.profile
	```
3. Вставить в профиль скрипт проверки состояния Агента и последующего автоматического запуска в случае его отсутствия в ОС Windows 10:

	```
	env=~/.ssh/agent.env

	agent_load_env () { test -f "$env" && . "$env" >| /dev/null ; }
	agent_start () {
		(umask 077; ssh-agent >| "$env")
		. "$env" >| /dev/null ; }

	agent_load_env

	#agent_run_state: 0=agent running w/key; 1=agent w/o key; 2=agent not running
	agent_run_state=$(ssh-add -l >| /dev/null 2>&1; echo $?)

	if [ ! "$ssh_auth_sock" ] || [ $agent_run_state = 2 ]; then
		agent_start
		ssh-add
	elif [ "$ssh_auth_sock" ] && [ $agent_run_state = 1 ]; then
		ssh-add
	fi

	unset env 
	```

4. Сохранить отредактированный файл профиля и выйти из текстового редактора. Выйти из терминала командой:
	```
	user@machine:~$ exit
	```
5. При последующем запуске bash-терминала будет производиться поиск запущенной службы Агента и добавление всех приватных ключей. 

	В случае запуска службы Агента скриптом и добавления ключей в терминале будет выведено текстовое сообщение. 

	В случае если служба уже запущена – текстовое сообщение не будет выведено. Таким образом исключается множественный запуск служб Агента в ОС Windows 10.

***Примечание: Полезные команды, которые могут быть использованы при работе с ssh-agent:***

	Иногда системе может быть установлено более одного пакета ssh. Для поиска и вывода директорий содержащих файлы ssh:
	```
	user@machine:~$ where ssh
	```
	***Не используемые пакеты SSH следует удалить во избежание конфликтов при выполнении команд.***

## После выполнения настройки Агента требуется сгенерировать пару ключей (public и private) по алгоритму RSA. 

1. При не указании имени файла ключом -f будут сгенерированы ключи в пути по умолчанию 
   
   ```~/.ssh/ key pair``` 
2. Выполнить в bash-терминале рекомендуемые параметры вызова утилиты ssh-keygen приведены в команде:
	```
	user@machine:~$ ssh-keygen -t rsa -b 4096 -C "user@email.com"
	```
3. Открыть bash-терминал и выполнить копирование публичного ключа на сервер.
	```
	user@machine:~$ ssh-copy-id -i ~/.ssh/id_rsa.pub <user>@<synology_nas>
	```

Для удобства работы создать файл конфигурации для входа на сервер
1. В bash-терминале перейти в локального пользователя командой:
	```
	user@machine:~$ cd ~
	```
2. Cоздать файл конфигурации для входа на Сервер:
	```
	user@machine:~$ touch .ssh/config
	```
3. Открыть файл кофигурации в редакторе(см. ранее) и добавить содержимое:
	```
	Host <alias>
    	HostName <sinology_nas>
    	User <user>
    	IdentityFile ~/.ssh/<private_key>
	```
4. Сохранить и закрыть файл. Выйти из терминала bash
5. Дальнешее подключение к серверу без логина и пароля осуществляется командой:
	```
	ssh <alias>
	```